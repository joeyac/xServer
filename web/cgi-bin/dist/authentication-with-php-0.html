<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hello VuePress | 0-开始使用 Slim</title>
    <meta name="description" content="Just playing around">


    <link rel="preload" href="/assets/css/5.styles.cc10635c.css" as="style">
    <link rel="preload" href="/assets/js/app.26f6b129.js" as="script">
    <link rel="preload" href="/assets/js/3.57cace51.js" as="script">
    <link rel="prefetch" href="/assets/js/0.06cf035d.js">
    <link rel="prefetch" href="/assets/js/1.24fb37b0.js">
    <link rel="prefetch" href="/assets/js/2.c891dd57.js">
    <link rel="prefetch" href="/assets/js/4.2fc96a3b.js">
    <link rel="stylesheet" href="/assets/css/5.styles.cc10635c.css">
</head>
<body>
<div id="app" data-server-rendered="true">
    <div class="theme-container">
        <header class="navbar">
            <div class="sidebar-button">
                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"
                     class="icon">
                    <path fill="currentColor"
                          d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path>
                </svg>
            </div>
            <a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Hello VuePress
    </span></a>
            <div class="links">
                <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value="">
                    <!----></div>
                <nav class="nav-links can-hide">
                    <div class="nav-item"><a href="/" class="nav-link">Home</a></div>
                    <div class="nav-item"><a href="/" class="nav-link">Guide</a></div>
                    <div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer"
                                             class="nav-link">External</a></div>
                    <a href="https://github.com/abowloflrf/c-server" target="_blank" rel="noopener noreferrer"
                       class="repo-link">
                        GitHub
                        <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100"
                             width="15" height="15" class="icon outbound">
                            <path fill="currentColor"
                                  d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path>
                            <polygon fill="currentColor"
                                     points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon>
                        </svg>
                    </a></nav>
            </div>
        </header>
        <div class="sidebar-mask"></div>
        <div class="sidebar">
            <nav class="nav-links">
                <div class="nav-item"><a href="/" class="nav-link">Home</a></div>
                <div class="nav-item"><a href="/" class="nav-link">Guide</a></div>
                <div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer"
                                         class="nav-link">External</a></div>
                <a href="https://github.com/abowloflrf/c-server" target="_blank" rel="noopener noreferrer"
                   class="repo-link">
                    GitHub
                    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100"
                         width="15" height="15" class="icon outbound">
                        <path fill="currentColor"
                              d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path>
                        <polygon fill="currentColor"
                                 points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon>
                    </svg>
                </a></nav>
            <ul class="sidebar-links">
                <li><a href="/authentication-with-php-0.html" class="active sidebar-link">开始使用 Slim</a>
                    <ul class="sidebar-sub-headers">
                        <li class="sidebar-sub-header"><a href="/authentication-with-php-0.html#上手-slim-framework"
                                                          class="sidebar-link">上手 Slim Framework</a></li>
                        <li class="sidebar-sub-header"><a href="/authentication-with-php-0.html#使用路由-router"
                                                          class="sidebar-link">使用路由 router</a></li>
                        <li class="sidebar-sub-header"><a href="/authentication-with-php-0.html#使用控制器-controller"
                                                          class="sidebar-link">使用控制器 controller</a></li>
                    </ul>
                </li>
                <li><a href="/authentication-with-php-1.html" class="sidebar-link">使用 Eloquent ORM 与 Twig</a></li>
                <li><a href="/authentication-with-php-2.html" class="sidebar-link">基本 Session 认证</a></li>
                <li><a href="/authentication-with-php-3.html" class="sidebar-link">使用中间件 Middleware</a></li>
            </ul>
        </div>
        <div class="page">
            <div class="content"><h1 id="_0-开始使用-slim"><a href="#_0-开始使用-slim" aria-hidden="true" class="header-anchor">#</a>
                0-开始使用 Slim</h1>
                <p></p>
                <div class="table-of-contents">
                    <ul>
                        <li><a href="#上手-slim-framework">上手 Slim Framework</a></li>
                        <li><a href="#使用路由-router">使用路由 router</a></li>
                        <li><a href="#使用控制器-controller">使用控制器 controller</a></li>
                    </ul>
                </div>
                <p></p>
                <hr>
                <p>为何使用 Slim 而不去使用众多流行使用广泛的 PHP 框架例如 Laravel 等等？因为目的是学习，而不是快速开发完成一个产品，学习的目的是了解某个功能在 PHP 代码中具体是怎样实现的，若使用
                    Laravel，其功能繁多，封装程度极高，以及框架中许多方便开发者使用的语义化方法、类等，都不利于我们学习基础知识。而使用 Slim，其只实现了基本的
                    router，request，response，dependency container 等等一些最最基本的功能，我们可以使用这个简单的骨架为基础开发扩展实现自己所需要的应用。</p>
                <h2 id="上手-slim-framework"><a href="#上手-slim-framework" aria-hidden="true" class="header-anchor">#</a>
                    上手 Slim Framework</h2>
                <p>首先使用<code>composer</code>创建</p>
                <pre class="language-text"><code>composer create-project slim/slim-skeleton php auth
</code></pre>
                <p>进入目录会发现生成了如下文件结构</p>
                <pre class="language-text"><code>.
├── public
│   └── index.php
├── src
│   ├── dependencies.php
│   ├── middleware.php
│   ├── routes.php
│   ├── settings.php
└── templates
    └── index.phtml
</code></pre>
                <p><code>public/index.php</code>为入口文件，所有的请求都会从此进入；<code>src</code>目录为项目代码的核心部分，绝大部分工作代码编写在此完成；<code>templates</code>为模板目录编写视图。首先看看<code>public/index.php</code>的内容：
                </p>
                <pre class="language-php"><code><span class="token php language-php"><span
                        class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span
                            class="token constant">PHP_SAPI</span> <span class="token operator">==</span> <span
                            class="token single-quoted-string string">'cli-server'</span><span
                            class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在使用PHP内置的cli-server时检查请求是否为静态文件</span>
    <span class="token variable">$url</span>  <span class="token operator">=</span> <span class="token function">parse_url</span><span
                            class="token punctuation">(</span><span class="token variable">$_SERVER</span><span
                            class="token punctuation">[</span><span class="token single-quoted-string string">'REQUEST_URI'</span><span
                            class="token punctuation">]</span><span class="token punctuation">)</span><span
                            class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span
                            class="token constant">__DIR__</span> <span class="token punctuation">.</span> <span
                            class="token variable">$url</span><span class="token punctuation">[</span><span
                            class="token single-quoted-string string">'path'</span><span
                            class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span
                            class="token function">is_file</span><span class="token punctuation">(</span><span
                            class="token variable">$file</span><span class="token punctuation">)</span><span
                            class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span
                            class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 加载composer autoload</span>
<span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span
                            class="token punctuation">.</span> <span class="token single-quoted-string string">'/../vendor/autoload.php'</span><span
                            class="token punctuation">;</span>
<span class="token comment">// 开始session（session是用户认证的关键）</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span
                            class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用`src/settings.php`的配置文件实例化Slim app</span>
<span class="token variable">$settings</span> <span class="token operator">=</span> <span
                            class="token keyword">require</span> <span class="token constant">__DIR__</span> <span
                            class="token punctuation">.</span> <span class="token single-quoted-string string">'/../src/settings.php'</span><span
                            class="token punctuation">;</span>
<span class="token variable">$app</span> <span class="token operator">=</span> <span
                            class="token keyword">new</span> <span class="token class-name"><span
                            class="token punctuation">\</span>Slim<span
                            class="token punctuation">\</span>App</span><span class="token punctuation">(</span><span
                            class="token variable">$settings</span><span class="token punctuation">)</span><span
                            class="token punctuation">;</span>
<span class="token comment">// 加载dependencies</span>
<span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span
                            class="token punctuation">.</span> <span class="token single-quoted-string string">'/../src/dependencies.php'</span><span
                            class="token punctuation">;</span>
<span class="token comment">// 注册中间件</span>
<span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span
                            class="token punctuation">.</span> <span class="token single-quoted-string string">'/../src/middleware.php'</span><span
                            class="token punctuation">;</span>
<span class="token comment">// 注册路由</span>
<span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span
                            class="token punctuation">.</span> <span class="token single-quoted-string string">'/../src/routes.php'</span><span
                            class="token punctuation">;</span>
<span class="token comment">// 运行</span>
<span class="token variable">$app</span><span class="token operator">-</span><span
                            class="token operator">&gt;</span><span class="token function">run</span><span
                            class="token punctuation">(</span><span class="token punctuation">)</span><span
                            class="token punctuation">;</span>
</span></code></pre>
                <p>运行命令，指定从<code>public</code>目录启动服务器：</p>
                <pre class="language-text"><code>php -S localhost:8080 -t public
</code></pre>
                <p>浏览器访问<code>localhost:8080</code>可以得到默认的模板文件<code>index.phtml</code>的内容。</p>
                <h2 id="使用路由-router"><a href="#使用路由-router" aria-hidden="true" class="header-anchor">#</a> 使用路由 router
                </h2>
                <p>不同 URI 的请求是通过<code>routes.php</code>中定义的路由所控制的，默认生成如下：</p>
                <pre class="language-php"><code><span class="token variable">$app</span><span
                        class="token operator">-</span><span class="token operator">&gt;</span><span
                        class="token function">get</span><span class="token punctuation">(</span><span
                        class="token single-quoted-string string">'/[{name}]'</span><span
                        class="token punctuation">,</span> <span class="token keyword">function</span> <span
                        class="token punctuation">(</span>Request <span class="token variable">$request</span><span
                        class="token punctuation">,</span> Response <span class="token variable">$response</span><span
                        class="token punctuation">,</span> <span class="token keyword">array</span> <span
                        class="token variable">$args</span><span class="token punctuation">)</span> <span
                        class="token punctuation">{</span>
    <span class="token comment">// 日志记录</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span
                            class="token operator">&gt;</span><span class="token property">logger</span><span
                            class="token operator">-</span><span class="token operator">&gt;</span><span
                            class="token function">info</span><span class="token punctuation">(</span><span
                            class="token double-quoted-string string">&quot;Slim-Skeleton '/' route&quot;</span><span
                            class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 渲染视图</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span
                            class="token operator">-</span><span class="token operator">&gt;</span><span
                            class="token property">renderer</span><span class="token operator">-</span><span
                            class="token operator">&gt;</span><span class="token function">render</span><span
                            class="token punctuation">(</span><span class="token variable">$response</span><span
                            class="token punctuation">,</span> <span class="token single-quoted-string string">'index.phtml'</span><span
                            class="token punctuation">,</span> <span class="token variable">$args</span><span
                            class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                <p>这里定义了一个 GET
                    请求的路由，所匹配为动态路由，<code>{name}</code>为定义的参数，例如访问<code>localhost:8080/hello</code>那么这个<strong>hello</strong>会作为参数传入，并在<code>index.phtml</code>模板中使用<code>$name</code>访问这个值
                </p>
                <h2 id="使用控制器-controller"><a href="#使用控制器-controller" aria-hidden="true" class="header-anchor">#</a>
                    使用控制器 controller</h2>
                <p>我们不可能将所有的匹配到路由后的处理逻辑都写在这个路由定义文件中，因此一般的做法是使用<strong>控制器
                    Controller</strong>，在<code>src/</code>目录下新建一个<code>Controller</code>目录，新建<code>HomeController.php</code>，并在新建的控制器类中新建一个方法以处理路由匹配到后要作如何处理。为了在每个控制器中都能够访问到container，可以定义一个BaseController，编写构造函数传入container：
                </p>
                <pre class="language-php"><code><span class="token php language-php"><span
                        class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span
                            class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Slim<span class="token punctuation">\</span>Container</span><span
                            class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$container</span><span
                            class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span
                            class="token punctuation">(</span>Container <span class="token variable">$c</span><span
                            class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span
                            class="token operator">&gt;</span><span class="token property">container</span> <span
                            class="token operator">=</span> <span class="token variable">$c</span><span
                            class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre>
                <p>然后定义自己的Controller继承这个BaseController</p>
                <pre class="language-php"><code><span class="token php language-php"><span
                        class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Controller</span><span
                            class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Slim<span class="token punctuation">\</span>Http<span
                            class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Slim<span class="token punctuation">\</span>Http<span
                            class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span
                            class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span
                            class="token punctuation">(</span>Request <span class="token variable">$request</span><span
                            class="token punctuation">,</span> Response <span
                            class="token variable">$response</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span
                            class="token operator">&gt;</span><span class="token property">container</span><span
                            class="token operator">-</span><span class="token operator">&gt;</span><span
                            class="token property">renderer</span><span class="token operator">-</span><span
                            class="token operator">&gt;</span><span class="token function">render</span><span
                            class="token punctuation">(</span><span class="token variable">$response</span><span
                            class="token punctuation">,</span> <span class="token single-quoted-string string">'home.phtml'</span><span
                            class="token punctuation">,</span> <span class="token variable">$args</span><span
                            class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre>
                <p>然后在<code>routes.php</code>中修改为：</p>
                <pre class="language-php"><code><span class="token variable">$app</span><span
                        class="token operator">-</span><span class="token operator">&gt;</span><span
                        class="token function">get</span><span class="token punctuation">(</span><span
                        class="token single-quoted-string string">'/home'</span><span class="token punctuation">,</span> <span
                        class="token single-quoted-string string">'\App\Controller\HomeController:index'</span><span
                        class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                <p>此时并不能运行起来，因为新建的目录和类并没有被自动加载，若运行会提示找不到这个类。因此在<code>composer.php</code>中添加一项：</p>
                <pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;autoload&quot;</span><span class="token operator">:</span> <span
                            class="token punctuation">{</span>
    <span class="token property">&quot;psr-4&quot;</span><span class="token operator">:</span> <span
                            class="token punctuation">{</span>
      <span class="token property">&quot;App\\&quot;</span><span class="token operator">:</span> <span
                            class="token string">&quot;src/&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                <p>意味composer会自动注册<code>src</code>目录下符合psr-4标准的<code>App\</code>命名空间下的类，接着运行</p>
                <pre class="language-text"><code>composer dump-autoload
</code></pre>
                <p>就可以正常运行了</p></div><!---->
            <div class="content page-nav"><p class="inner"><!----><span class="next"><a
                    href="/authentication-with-php-1.html">
          使用 Eloquent ORM 与 Twig
        </a> →
      </span></p></div>
        </div>
    </div>
</div>
<script src="/assets/js/3.57cace51.js" defer></script>
<script src="/assets/js/app.26f6b129.js" defer></script>
</body>
</html>
